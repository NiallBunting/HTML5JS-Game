
<!DOCTYPE HTML>
<html>
	<head>
		<title>Play Game</title>
	</head>
	
	<body onLoad="start_game()">
		<header> 
			<p>
				Click <a href="http://users.aber.ac.uk/jpd4/CS252/about.html">here</a> to visit the about page <br>
				Move the rectangle to avoid the falling ones! <br>
				After starting the game press tab to control the rectangle!
			</p>
		</header>
		
<!--	Code related to creating multiple "layers" of canvas' isnt mine own
		and is credited below.
		This refers to lines 20-30
		http://stackoverflow.com/questions/3008635/html5-canvas-element-multiple-layers -->
		<section style="position: relative;">
			<!-- score -->
			<canvas id="score" width="500" height="400" tabindex="0" 
				style="position: absolute; border-style: solid; border-width: 2px; width: 500px; left: 0; top: 0; z-index: 0;"></canvas>
			<!-- foreground -->
			<canvas id="canvas_1" width="500" height="400" tabindex="1"
				style="position: absolute; border-style: solid; border-width: 2px; width: 500px; left: 0; top: 0; z-index: 0;"></canvas>
			<!-- background -->
			<canvas id="grav" width="500" height="400" tabindex="0" 
				style="position: absolute; border-style: solid; border-width: 2px; width: 500px; left: 0; top: 0; z-index: 0;"></canvas>d
		</section>
		
		<script>
			// Code related to doKeyDown is not my code and is credited below
			// This code is found on lines 35-39, 55-56, 64-90
			// http://www.homeandlearn.co.uk/JS/html5_canvas_keyboard_keys.html
			// http://www.homeandlearn.co.uk/JS/move_box_keyboard.txt
			
			// Code related to falling rectangle is not my code and is credited below
			// This code is found on lines 51-60, 99-121
			// http://www.aber.ac.uk/~dcswww/Dept/Teaching/CourseNotes/current/CS25210/slides/lecture7.html#16
			
			var canvas = document.getElementById("canvas_1");
			canvas.addEventListener('keydown', doKeyDown, true);

			canvas_context = canvas.getContext("2d");
			canvas_context.fillRect(100, 370, 50, 30);
			
			var can = document.getElementById("score");
			can_context = canvas.getContext("2d");
			
			var cx;
			var cy;
			var dy=0.1; // change in y
			var gravity=2;
			var drag=0.9;
			var c_canvas = document.getElementById("grav");
			var c_context = c_canvas.getContext("2d");
			var cls;

			c_context.fillStyle="rgb(255,20,20)";

			var x = 100;
			var y = 370;
			
			var sor = 0;
			var scr = "Score: ";
			var score = sor.concat(scr);
			
			var alive = true;

			function doKeyDown(e){
				// Moving Left
				if (e.keyCode == 65) {
					clearCanvas();
					if(x <= 9){
						canvas_context.fillRect(x, y, 50, 30);
					} else {
						x = x - 10;
						canvas_context.fillRect(x, y, 50, 30);
					}
				}

				// Moving Right
				if (e.keyCode == 68) {
					clearCanvas();
					if(x >= 445){
						canvas_context.fillRect(x, y, 50, 30);
					} else {
						x = x + 10;
						canvas_context.fillRect(x, y, 50, 30);
					}
				}
			}

			function clearCanvas() {
				canvas.width = canvas.width;
			}
			
			function drop_box() {
				displayScore();
				//stop_game();
				//cx=Math.random()*c_canvas.width;
				//cy=0;
				dy=0.1; // change in y
				gravity=2;
				drag=0.9;
			}
			
			function draw_b_box() {
				c_canvas.width=c_canvas.width;
				if (cy>=(c_canvas.height-20)) {
					// c_context.clearRect(cx, cy, 20, 20);
					drop_box();
				} else {
					dy=dy*drag+gravity;
				}
				cy+=dy;
				c_context.fillRect(cx, cy, 20, 20);      
			}
			
			function start_game(){
				// Condition doesn't work.

				requestAnimationFrame(game_loop);
			}
			
			function game_loop(){
				drop_box();
				draw_b_box();
				requestAnimationFrame(game_loop);
			}
			
			// Doesn't work.
			function displayScore(){
				score++;
				can_context.font = "30px serif"
				can_context.fillStyle = "#FF0000";
				can_context.fillText (score, 30, 50);
			}
			
			// Code to check collision isnt my own and is credited below
			// This code is found on line 142
			// http://www.gaminglogy.com/tutorial/collision-detection/
			
			// Doesn't work.
			//function stop_game(){
			//	if ((x <= cx && x+50 >= cx) && (y <= cy && y+30 >= cy)){
			//		alive = false;
			//	} else {
			//		alive = true;
			//	{
			//}
			
		</script>
	</body>
</html>
		

